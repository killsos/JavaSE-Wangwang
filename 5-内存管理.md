## 内存管理

#### 5.1 Java内存管理

	我们使用的变量就是计算机中一块块内存空间。那么Java是如何创使用和收集这些内存空间
	
	Java 程序、Java 虚拟机与操作系统之间使用分配内存的相互关系
	
5.1.1 程序运行前:

    有些编程语言编写的程序会直接向操作系统请求内存，但 Java 并不支持那么做。
	
	这样做的一个重要优点是保证了程序的平台无关性。
	
	既然 Java 程序不负责创建内 存空间，那由谁创建呢?
	
	是由 JVM 完成。当程序准备执行时，由 JVM 向操作系统请求一定的内存空间，称为初始内存空间。
	
	程序执行过程中所需的内存都由 Java 虚拟机从这片内存空间中划分
	
5.1.2 程序运行中:
	
	Java程序一直向 Java 虚拟机申请内存，当程序所需内存空间超出初始内存空间时
	
	Java虚拟机会再次向操作系统申请更多的内存供程序使用。
	
5.1.3 内存溢出:
	
	程序接着运行 当Java虚拟机已申请的内存达到了规定的最大内存空间(默认是64M)
	
	但程序还需要更多的内存，这时会出现内存溢出的错误

5.1.4 总结:
	
	Java 程序所使用的内存是由 Java 虚拟机进行管理、分配的
	
	Java 虚拟机规定了 Java 程序的初始内存空间和最大内存空间
	
	开发者只需要关心 Java 虚拟机是如何 管理内存空间的
	
	而不用关心某一种操作系统是如何管理内存的
	
5.1.5 RUNTIME 类的使用
	
	Java 给我们提供了 Runtime 类得到 JVM 内存的信息



| 方法名称        | 参数    |  作用  | 返回值  |
| --------       | -----  | ----  |---- |
| getRuntime         | 无       |   获取Runtime对象               |  Runtime 对象    |
| totalMemory        | 无       |   获取JVM分配给程序的内存数量      |   long:内存数量   |
| freeMemory         | 无       |   获取当前可用的内存数量           |   long:内存数量   |
| maxMemory          | 无       |   获取 JVM 可以申请到的最大内存数量 |   long:内存数量   |



5.1.6 内存空间逻辑划分: 方法区 堆 与 栈
	
	JVM 会把申请的内存从逻辑上划分为三个区域，即:方法区、堆与栈
	
	Java虚拟机对应的在内存中划分了三个区域“方法区”、“堆区”和“栈 区”
	
	分别保存类结构、对象中的数据 和 变量(基本型和引用型)
	
	这三个内存区域都有 大小限制
	
	任何一个区域内存溢出都会导致程序出现错误，栈内存溢出会发生 StackOverflowException错误
	
	堆内存溢出会发生OutOfMemoryError错误

5.1.7 方法区

	方法区中的内存分配:方法区默认最大容量为64M
	
	Java虚拟机会将加载的java类存入方法区
	
	保存类的结构(属性与方法) 类静态成员等内容
	
	编写中小型程序时，一般不会 造成方法区的内存溢出

5.1.8 堆
	
	堆中的内存分配:堆默认最大容量为64M
	
	堆存放对象持有的数据 同时保持对原类的引用
	
	可以简单的理解为对象属性的值保存在堆中   对象调用的方法保存在方法区
	
5.1.9 栈

	栈中的内存分配:栈默认最大容量为1M
	
	在程序运行时 每当遇到方法调用时Java虚拟机就会在栈中划分一块内存称为 ##栈帧(Stack frame)##
	
	栈帧中的内存供局部变量(包括 基本类型与引用类型)  引用型变量的数据还在堆里
	
	使用当方法调用结束后，Java虚拟机会收回此栈帧占用的内存
	

#### 5.2  Java的数据类型

	JAVA中没有指针  但JAVA底层封装了指针
	
	但也并不是所有的类型都封装了指针 根据这点不同java的数据类型分为两类
	
	即:值类型(基本数据类型) 和 引用类型


* 值类型:又称基本数据类型和基元数据类型  没封装指针的变量  
	
	声明值类型的变量只会在栈中分配一块内存空间
	

* 引用类型:就是底层封装指针的数据类型  

	包括或自定义或系统提供的所有类 所有抽象类 接口 数组 
	
	在内存中分配两块空间，第一块内存分配在栈中 只存放堆中的内存地址 不存放具体数值 我们也把它叫指针类型的变量
	
	第二块内存分配在堆中 存放的是具体数值，如对象属性值等
	
	
#### 5.3  声明对象与创建对象

5.3.1 声明对象
	
	我们已经知道，类是引用类型，那声明对象就相当于在栈中声明指针类型的变量
	
	它的内存不存放具体的数值 而只存放另一块堆中内存的地址
	
5.3.2 创建对象
	
	在 java 中一般使用 new 关键字创建对象
	
	当然还有更高级的反射可以不用 new 关键字
	
	对象必须创建后才能使用 如果只声明不创建 
	
	那么调用对象属性和方法时 将会报空指针异常(NullPointerException)
	
	空指针异常是因为没有指向堆中内存引起的
	
	
#### 5.4  JAVA 值传参与引用传参

	类中包含方法, 方法又分为 方法声明 和 方法实现 
	
	方法声明中又有参数列表, 参数根据 调用后的效果不同
	
	即是否改变参数的原始数值, 又可以分为两种:  按值传递的参数 与 按引用传递的参数
	
	按值 传递参数 数值不变
	
	按引用 传递参数 数值改变
	
	基本数据类型就是按值传递的 又称为值类型
	
	引用类型是按引用传递的
	
	当方法调用时 实参这里相当于把栈中的数据全备份一份
	
	不管是按值传递还是按引用传递，都是把栈中的数据备份了一份给参数变量
	
	只不过值类型备份的是具体的数值，而引用类型备份的是内存地址
	
	所以从这个角度 看，我们也可以说 Java 全部是按值传参的，因为它都是把数据备份了一份
	
	
#### 5.5  特殊STRING类

	特殊: STRING类是引用类型，但数值却不会改变
	
[String是定长][https://www.tianmaying.com/tutorial/java-String]